/* Imports */
@import 'tailwindcss';
@source "../mdx-components.tsx";

@layer utilities {
  .font-thin { font-variation-settings: 'wght' 100, var(--sans-variation); }
  .font-extralight { font-variation-settings: 'wght' 200, var(--sans-variation); }
  .font-light { font-variation-settings: 'wght' 300, var(--sans-variation); }
  .font-normal { font-variation-settings: 'wght' 440, var(--sans-variation); }
  .font-medium { font-variation-settings: 'wght' 500, var(--sans-variation); }
  .font-semibold { font-variation-settings: 'wght' 600, var(--sans-variation); }
  .font-bold { font-variation-settings: 'wght' 640, var(--sans-variation); }
  .font-extrabold { font-variation-settings: 'wght' 700, var(--sans-variation); }
  .font-black { font-variation-settings: 'wght' 800, var(--sans-variation); }
}

/* Theme */
@theme {
  --color-rurikon-50: #ebeceb;
  --color-rurikon-100: #d8d9d6;
  --color-rurikon-200: #b3b5b0;
  --color-rurikon-300: #958a82;
  --color-rurikon-400: #756962;
  --color-rurikon-500: #554d46;
  --color-rurikon-600: #45403a;
  --color-rurikon-700: #35302a;
  --color-rurikon-800: #2b2622;
  --color-rurikon-900: #1e1b17;
  --color-rurikon-950: #12100d;
  --color-rurikon-border: #d8d9d6b3;

  --font-family-sans: var(--sans), -apple-system, ui-sans-serif, system-ui,
    sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  --font-family-serif: var(--serif), ui-serif, Georgia, Cambria, 'Times New Roman', Times, serif;
  --font-family-mono: var(--mono), ui-monospace, SFMono-Regular, Menlo, Monaco,
    Consolas, 'Liberation Mono', 'Courier New', monospace;
  --font-family-zh: var(--sans), -apple-system, ui-sans-serif, system-ui,
    'PingFang SC', 'Hiragino Sans GB', 'Source Han Sans CN', sans-serif;

  --breakpoint-text: 1220px;
  --breakpoint-mobile: 480px;
}

:root {
  --background: #f9f4ed;
  --sans-variation: 'opsz' 32;
  --font-features: 'cpsp' 1, 'cv01', 'cv03', 'cv04', 'calt', 'ss03', 'liga', 'ordn';
}

/* Base */
html {
  font-size: clamp(13.5px, 0.9vw + 10px, 19px);
}

body {
  font-synthesis: none;
  font-family: var(--sans), system-ui, -apple-system, BlinkMacSystemFont,
    'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
  font-feature-settings: var(--font-features);
  font-variation-settings: 'wght' 440, var(--sans-variation);
  font-variant: common-ligatures contextual;
  font-optical-sizing: auto;
  text-decoration-skip-ink: auto;
  text-spacing-trim: space-first;
  text-rendering: geometricPrecision;
  text-autospace: normal;
  letter-spacing: 0.005em;
  word-spacing: -0.02em;
  line-height: clamp(1.45em, calc(1.45em + 0.22vw), 1.65em);
  background-color: var(--background);
}

*::selection {
  background: #95a5ac40;
  color: #485a74;
}

main {
  hanging-punctuation: first allow-end last;
  hyphens: auto;
  hyphenate-limit-chars: 10 5 5;
  text-wrap: pretty;
}

del { text-decoration-thickness: 1px; }
blockquote + blockquote { display: flow-root; }

/* Typography */
h1 {
  font-size: clamp(2rem, 5.2vw, 4.5rem);
  line-height: clamp(1.05em, calc(1.05em + 0.2vw), 1.15em);
  letter-spacing: -0.02em;
}

h2 {
  font-size: clamp(1.25rem, 2vw, 2.25rem);
  font-variation-settings: 'wght' 400, var(--sans-variation);
  line-height: clamp(1.15em, calc(1.15em + 0.15vw), 1.25em);
  letter-spacing: -0.01em;
}

h3 {
  font-size: clamp(1.05rem, 1.5vw, 1.5rem);
  line-height: clamp(1.2em, calc(1.2em + 0.15vw), 1.3em);
  letter-spacing: -0.005em;
}

i, em, blockquote, nav, .sidenote, .font-serif {
  font-family: var(--serif), Baskerville, Georgia, Cambria, 'Times New Roman', Times, serif;
  font-optical-sizing: auto;
  font-weight: 400;
  font-variant-ligatures: contextual;
  letter-spacing: -0.003em;
  line-height: 1.5;
}

.font-serif {
  font-family: var(--serif), Baskerville, Georgia, Cambria, 'Times New Roman', Times, serif;
  font-optical-sizing: auto;
  font-variation-settings: 'wght' 400;
  letter-spacing: -0.005em;
}

.font-serif.font-light {
  font-variation-settings: 'wght' 300;
  letter-spacing: -0.008em;
}

.font-serif.font-medium {
  font-variation-settings: 'wght' 500;
}

.eb-garamond-italic {
  font-family: 'EB Garamond', var(--serif), Baskerville, Georgia, Cambria, 'Times New Roman', Times, serif !important;
  font-style: italic !important;
}

h1.eb-garamond-italic {
  font-weight: 800 !important;
}

.text-rurikon-300.italic {
  font-style: italic !important;
  font-family: var(--serif), Baskerville, Georgia, Cambria, 'Times New Roman', Times, serif !important;
}

/* Keyframes */
@keyframes textBlurIn {
  0% { filter: blur(4px); opacity: 0; transform: scale(0.98); }
  50% { filter: blur(1px); opacity: 0.6; transform: scale(0.99); }
  100% { filter: blur(0px); opacity: 1; transform: scale(1.0); }
}

@keyframes textFadeIn {
  0% { filter: blur(4px); opacity: 0; }
  100% { filter: blur(0px); opacity: 1; }
}

@keyframes dotScale {
  0% { opacity: 0; transform: scale(0.5); }
  100% { opacity: 1; transform: scale(1); }
}

@keyframes timelineBlurIn {
  0% { filter: blur(8px); opacity: 0; }
  50% { filter: blur(1px); opacity: 0.6; }
  100% { filter: blur(0px); opacity: 1; }
}

@keyframes hide {
  0% { opacity: 1; filter: blur(0); }
  100% { opacity: 0; filter: blur(4px); }
}

@keyframes appear {
  0% { opacity: 0; filter: blur(4px); }
  100% { opacity: 1; filter: blur(0); }
}

@keyframes floatUp {
  0% { opacity: 0; transform: translateY(4px); }
  100% { opacity: 0.9; transform: translateY(0); }
}

@keyframes fade-in {
  0% { opacity: 0; transform: scale(0.95) translateY(-10px); }
  100% { opacity: 1; transform: scale(1) translateY(0); }
}

/* Animations */
.stagger-title {
  animation: textBlurIn 0.4s ease-out forwards;
  filter: blur(4px);
  opacity: 0;
  transform: scale(0.98);
}

.stagger-title:nth-child(1) { animation-delay: 0.1s; }
.stagger-title:nth-child(2) { animation-delay: 0.3s; }
.stagger-title:nth-child(3) { animation-delay: 0.5s; }
.stagger-title:nth-child(4) { animation-delay: 0.7s; }

.stagger-dot {
  animation: dotScale 0.5s ease-out forwards;
  animation-delay: 2.4s;
  opacity: 0;
  transform: scale(0.5);
}

.stagger-word {
  animation: textFadeIn 1s ease-out forwards;
  filter: blur(4px);
  opacity: 0;
  display: inline-block;
}

.stagger-timeline-entry {
  animation: timelineBlurIn 0.5s ease-out forwards;
  filter: blur(5px);
  opacity: 0;
  will-change: filter, opacity;
}

.skip-animations .stagger-title,
.skip-animations .stagger-dot,
.skip-animations .stagger-word {
  animation: none !important;
  filter: none !important;
  opacity: 1 !important;
  transform: none !important;
}

.timeline-animation-seen .stagger-timeline-entry {
  animation: none !important;
  filter: none !important;
  opacity: 1 !important;
  transform: none !important;
}

.animate-fade-in {
  animation: fade-in 0.3s ease-out forwards;
}

@supports (view-transition-name: none) {
  @media not (prefers-reduced-motion: reduce) {
    ::view-transition-old(crossfade) {
      animation: hide 0.16s cubic-bezier(0.6, 0, 0.8, 1) forwards;
    }
    ::view-transition-new(crossfade) {
      opacity: 0;
      animation: appear .18s ease 0s forwards;
    }
  }
}

/* Code */
code {
  font-family: var(--mono), ui-monospace, SFMono-Regular, Menlo, Monaco,
    Consolas, 'Liberation Mono', 'Courier New', monospace;
  word-spacing: -0.15em;
  background: transparent;
  --shiki-token-comment: hsl(30deg 8% 48% / 0.65);
  --shiki-token-punctuation: hsl(30deg 6% 44% / 0.75);
  --shiki-token-operator: hsl(30deg 8% 44% / 0.8);
  --shiki-token-variable: hsl(30deg 12% 46%);
  --shiki-token-parameter: hsl(30deg 15% 48%);
  --shiki-token-constant: hsl(30deg 35% 48%);
  --shiki-token-number: hsl(30deg 35% 48%);
  --shiki-token-escape: hsl(30deg 30% 48%);
  --shiki-token-keyword: hsl(25deg 30% 48%);
  --shiki-token-type: hsl(25deg 25% 48%);
  --shiki-token-function: hsl(180deg 25% 46%);
  --shiki-token-link: hsl(180deg 25% 46%);
  --shiki-token-property: hsl(180deg 20% 46%);
  --shiki-token-string: hsl(150deg 20% 44%);
  --shiki-token-string-expression: hsl(150deg 20% 44%);
  --shiki-token-regex: hsl(150deg 22% 45%);
  --shiki-token-class-name: hsl(20deg 18% 48%);
}

code span { transition: color 0.2s; }

pre {
  --shiki-foreground: #3a3531;
  --shiki-background: transparent;
  background-color: #fafaf8;
  border: 1px solid #e8e7e3;
  border-radius: 6px;
  container-type: inline-size;
  overflow-x: auto;
  padding: clamp(0.75rem, 1.8vw, 1.8rem);
  margin: 2.25rem 0;
  -webkit-font-smoothing: auto;
  max-width: 100%;
  box-sizing: border-box;
}

pre code {
  display: block;
  padding: 0;
  line-height: 1.5;
  font-size: clamp(0.85rem, 1.5cqw, 1.05rem);
  white-space: pre;
}

@media (max-width: 640px) {
  pre code {
    font-size: clamp(0.8rem, 1.8cqw, 1rem);
    line-height: 1.4;
  }
}

/* Article */
article {
  figure {
    margin-top: 2.25rem;
    line-height: 0;
  }

  .about-intro-balance { text-wrap: balance; }

  .sidenote-content {
    img, video, pre { margin: 0; }
  }

  .framed > img,
  .framed > figure > span:first-child {
    padding: var(--frame-padding, 1.125rem);
    background: var(--frame-background, #fff);
    border: 1px solid var(--color-rurikon-border);
  }

  iframe {
    width: 100%;
    border: 1px solid var(--color-rurikon-border);
    background-color: #fff;
  }

  details {
    margin-top: 2.25rem;
    padding: 0.65rem 0;
    border-top: 1px solid var(--color-rurikon-border);
    border-bottom: 1px solid var(--color-rurikon-border);
  }

  details summary {
    font-variation-settings: 'wght' 600, var(--sans-variation);
    margin-bottom: 0.35rem;
  }

  details summary::marker { content: ''; }
  details p:first-of-type { margin-top: 0; }
}

article .thought-article .article-p,
article .thought-article li {
  font-size: 0.8em;
}

article .thought-article em,
article .thought-article i,
article .thought-article .font-serif,
article .thought-article blockquote {
  font-size: 1.05em;
}

article .thought-article h2 {
  font-size: clamp(1.35rem, 1.9vw, 2.1rem);
}

article .thought-article h3 {
  font-size: clamp(1.15rem, 1.4vw, 1.35rem);
}

/* Whoami */
.whoami-header {
  max-width: 66ch;
  margin-bottom: 3rem;
}

.whoami-intro { margin-bottom: 2.5rem; }

.whoami-section-title {
  font-size: clamp(1.75rem, 2.4vw, 2.1rem);
  font-weight: 500;
  color: rgb(31, 41, 55);
  margin-top: 4rem;
  margin-bottom: 2rem;
  padding-top: 2.5rem;
  letter-spacing: 0.025em;
  border-top: 1px solid rgba(107, 114, 128, 0.15);
}

.whoami-section-title:first-of-type {
  border-top: none;
  margin-top: 1.5rem;
  padding-top: 0;
}

.whoami-section-title + h2 { margin-top: 0; }

.whoami-section-title ~ h2 {
  margin-top: 1.5rem;
  margin-bottom: 1rem;
  font-size: clamp(1.45rem, 2.3vw, 2.5rem);
}

@media (min-width: 480px) {
  .whoami-header { max-width: min(66ch, 50vw); }
}

/* Links */
a {
  transition: color 0.3s ease;
  position: relative;
}

main a:hover {
  color: #B85252;
  text-decoration-color: #B85252;
}

main a:hover span { color: #B85252; }

.underline {
  text-decoration-thickness: 1px;
  text-underline-offset: 0.2em;
  transition: all 0.2s ease;
}

.underline:hover { text-decoration-thickness: 2px; }

/* Timeline */
.timeline-wrapper {
  position: relative;
  max-width: 66ch;
  display: flex;
  flex-direction: column;
  align-items: center;
  --timeline-axis: 40%;
  --timeline-branch-gap: 1.5rem;
  --timeline-column-width: calc(100% - var(--timeline-axis) - var(--timeline-branch-gap));
}

.timeline {
  position: relative;
  padding: 0 0 4rem;
  isolation: isolate;
  width: 100%;
}

.timeline::before {
  content: '';
  position: absolute;
  left: 0;
  top: 0;
  bottom: 2rem;
  width: 1px;
  background: transparent;
  opacity: 0;
  z-index: 0;
}

.sticky-year-indicator {
  position: sticky;
  top: 0.5rem;
  display: flex;
  align-items: baseline;
  gap: 0.05em;
  font-size: clamp(0.85rem, 0.5vw + 0.75rem, 0.95rem);
  font-weight: 600;
  color: var(--color-rurikon-400);
  letter-spacing: 0.15em;
  font-family: var(--font-family-sans);
  text-transform: uppercase;
  margin-bottom: 1rem;
  padding: 0.25rem 0.5rem;
  background: var(--background);
  border-radius: 4px;
  z-index: 10;
  pointer-events: none;
  align-self: flex-start;
  margin-left: var(--timeline-axis);
  transform: translateX(-50%);
}

.year-odometer {
  display: inline-flex;
  overflow: hidden;
  width: 0.65em;
  height: 1em;
}

.odometer-digits {
  display: flex;
  flex-direction: column;
  width: 100%;
}

.odometer-digit {
  display: block;
  width: 100%;
  text-align: left;
  height: 1em;
  line-height: 1;
  flex-shrink: 0;
}

.binary-line {
  position: absolute;
  left: var(--timeline-axis);
  transform: translateX(-50%);
  top: 0;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: flex-start;
  gap: 0.75rem;
  z-index: 0;
  pointer-events: none;
  opacity: 0.35;
  will-change: transform;
}

.binary-digit {
  font-family: var(--mono);
  font-size: 0.8rem;
  line-height: 0.65;
  color: var(--color-rurikon-400);
  font-weight: 500;
  flex-shrink: 0;
  display: inline-block;
  transition: color 0.2s ease-out;
}

.timeline-fade-top {
  position: sticky;
  top: -4rem;
  left: 0;
  margin-top: -6rem;
  margin-left: -3rem;
  width: calc(100% + 6rem);
  height: 14rem;
  margin-bottom: -8rem;
  padding-top: 4rem;
  background: linear-gradient(to bottom,
    var(--background) 0%, var(--background) 25%,
    rgba(249, 244, 237, 0.95) 40%, rgba(249, 244, 237, 0.7) 60%,
    rgba(249, 244, 237, 0.3) 80%, rgba(249, 244, 237, 0) 100%);
  pointer-events: none;
  z-index: 9;
}

.timeline-fade-bottom {
  position: sticky;
  bottom: 0;
  left: 0;
  margin-left: -3rem;
  width: calc(100% + 3rem);
  height: 28rem;
  margin-top: -14rem;
  background: linear-gradient(to top,
    var(--background) 0%, rgba(249, 244, 237, 0.95) 8%,
    rgba(249, 244, 237, 0.75) 25%, rgba(249, 244, 237, 0.4) 50%,
    rgba(249, 244, 237, 0.1) 75%, rgba(249, 244, 237, 0) 100%);
  pointer-events: none;
  z-index: 9;
}

.timeline-year-marker {
  position: relative;
  height: 0;
  margin: 3rem 0 0;
  padding: 0;
  opacity: 0;
  pointer-events: none;
  overflow: hidden;
}

.year-label {
  position: absolute;
  font-size: 0.7rem;
  font-weight: 600;
  color: var(--color-rurikon-400);
  letter-spacing: 0.12em;
  font-family: var(--font-family-sans);
  text-transform: uppercase;
  visibility: hidden;
}

.timeline-entry {
  position: relative;
  display: flex;
  align-items: flex-start;
  margin-bottom: 2.5rem;
}

.timeline-entry:nth-child(odd of .timeline-entry) {
  padding-left: calc(var(--timeline-axis) + var(--timeline-branch-gap));
  justify-content: flex-start;
}

.timeline-entry:nth-child(even of .timeline-entry) {
  padding-right: calc((100% - var(--timeline-axis)) + var(--timeline-branch-gap));
  justify-content: flex-end;
  flex-direction: row-reverse;
}

.entry-connector {
  position: relative;
  width: 2.5rem;
  height: 1px;
  background: var(--color-rurikon-400);
  opacity: 0.35;
  flex-shrink: 0;
  margin-top: 2rem;
}

.timeline-entry:nth-child(odd of .timeline-entry) .entry-connector {
  margin-right: 0.5rem;
  transform: rotate(45deg);
  transform-origin: right center;
}

.timeline-entry:nth-child(odd of .timeline-entry) .entry-connector::after {
  content: '';
  position: absolute;
  left: -1rem;
  top: 50%;
  transform: translateY(-50%) rotate(-45deg);
  width: 1rem;
  height: 1px;
  background: var(--color-rurikon-400);
  transform-origin: right center;
}

.timeline-entry:nth-child(even of .timeline-entry) .entry-connector {
  margin-right: -0.5rem;
  transform: rotate(-45deg);
  transform-origin: left center;
}

.timeline-entry:nth-child(even of .timeline-entry) .entry-connector::after {
  content: '';
  position: absolute;
  right: -1rem;
  top: 50%;
  transform: translateY(-50%) rotate(45deg);
  width: 1rem;
  height: 1px;
  background: var(--color-rurikon-400);
  transform-origin: left center;
}

.entry-content {
  font-family: var(--font-family-serif);
}

.timeline-entry:nth-child(odd of .timeline-entry) .entry-content {
  max-width: var(--timeline-column-width);
  text-align: left;
}

.timeline-entry:nth-child(even of .timeline-entry) .entry-content {
  text-align: right;
  margin-left: auto;
}

.entry-month {
  display: block;
  font-size: clamp(0.65rem, 0.5vw + 0.5rem, 0.75rem);
  font-weight: 600;
  color: var(--color-rurikon-300);
  text-transform: uppercase;
  letter-spacing: 0.12em;
  margin-bottom: 0.65rem;
  font-family: var(--font-family-sans);
  transition: color 0.5s cubic-bezier(0.19, 1.0, 0.22, 1.0);
}

.timeline-entry:hover .entry-month {
  color: var(--color-rurikon-400);
}

.entry-content p {
  font-family: 'EB Garamond', var(--serif), Baskerville, Georgia, Cambria, 'Times New Roman', Times, serif;
  font-size: clamp(0.75rem, 0.6vw + 0.6rem, 0.95rem);
  color: var(--color-rurikon-600);
  line-height: 1.7;
  margin: 0 0 0.75rem 0;
  transition: color 0.5s cubic-bezier(0.19, 1.0, 0.22, 1.0);
}

.timeline-entry:hover .entry-content p {
  color: var(--color-rurikon-700);
}

.entry-content p:last-child { margin-bottom: 0; }

@media (min-width: 480px) {
  .timeline-wrapper { max-width: min(66ch, 90vw); }
}

@media (max-width: 900px) {
  .timeline-wrapper {
    --timeline-axis: 46%;
    --timeline-branch-gap: 1.25rem;
  }
}

@media (max-width: 768px) {
  .timeline-wrapper {
    max-width: 100%;
    --timeline-column-width: 100%;
  }

  .timeline-fade-top {
    top: 0;
    margin-left: 0;
    width: 100%;
  }

  .timeline-fade-bottom {
    margin-left: 0;
    width: 100%;
  }

  .sticky-year-indicator {
    top: 0.25rem;
    font-size: 0.85rem;
    padding: 0.2rem 0.4rem;
    z-index: 40;
  }

  .year-odometer,
  .odometer-digit {
    height: 1em;
    line-height: 1;
  }

  .timeline { padding: 0 0 4rem; }
  .timeline::before { bottom: 2rem; }

  .timeline-entry {
    margin-bottom: 2rem;
    padding-left: 0;
  }

  .timeline-entry:nth-child(odd of .timeline-entry) .entry-connector {
    margin-right: 0.5rem;
  }

  .timeline-year-marker {
    padding-left: 0;
    margin: 3rem 0 1.5rem;
  }
}

@media (max-width: 640px) {
  .timeline-wrapper {
    --timeline-axis: 50%;
    --timeline-branch-gap: 1rem;
  }
}

/* Utilities */
.nowrap-group { white-space: nowrap; }
.space-y-6 > * + * { margin-top: 2.5rem; }
.space-y-8 > * + * { margin-top: 3rem; }
.content-fade-out { background: linear-gradient(to bottom, #fcfcfc, #fcfcfc00); }

.dot-leaders {
  text-align: end;
  height: 1em;
  overflow: hidden;
  word-wrap: break-word;
  letter-spacing: 6px;
}

.dot-leaders::after {
  content: '······································································';
}
